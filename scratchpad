import pandas as pd
from datetime import datetime

# Load CSV file
df = pd.read_csv('input.csv')

# Step 1: Parse 'Age' column (D) to extract date and calculate days difference
today = datetime(2025, 4, 25)

def compute_days_old(age_str):
    try:
        date_part = age_str.split(' ')[0]  # Get date before first space
        age_date = pd.to_datetime(date_part)
        return (today - age_date).days
    except Exception:
        return None  # Will become NaN in pandas

df['Age as of Today'] = df['Age'].apply(compute_days_old)

# Step 2: Remove rows where Age as of Today is NaN
df = df.dropna(subset=['Age as of Today'])

# Step 3: Create 'FormattedNamespace'
df['FormattedNamespace'] = df['Namespace'].apply(lambda x: f"cmeprod/{str(x).lower()}")

# Step 4: Write to Excel
df.to_excel('report_with_columns.xlsx', index=False)
